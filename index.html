<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    
    <title>–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ –ö–§–£</title>
    <meta name="apple-mobile-web-app-title" content="–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ –ö–§–£">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

    <style>
        :root {
            --ios-bg: #000000;
            --ios-pink: #ff375f;
            --ios-blue: #007aff;
            --ios-green: #30d158;
            --text-main: #ffffff;
            --text-secondary: #a1a1a6;
            --island-bg: rgba(255, 255, 255, 0.05);
            --card-glass: rgba(255, 255, 255, 0.03);
            --card-blur: 30px; 
            --glow-1: rgba(255, 55, 95, 0.45);
            --glow-2: rgba(0, 122, 255, 0.35);
            --glass-opacity: 0.03;
            

            --icon-main-color: #ff375f; 
            --icon-glow: rgba(255, 55, 95, 0.6); 
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { background: var(--ios-bg); color: var(--text-main); font-family: -apple-system, BlinkMacSystemFont, "SF Pro Display", sans-serif; margin: 0; padding: 0; letter-spacing: -0.03em; overflow-x: hidden; }

        .bg-glow { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: radial-gradient(circle at 0% 0%, var(--glow-1) 0%, transparent 60%), radial-gradient(circle at 100% 100%, var(--glow-2) 0%, transparent 60%), #000; z-index: -1; transition: 0.8s ease; }

        .header-islands { position: sticky; top: 0; z-index: 1000; padding: 50px 16px 15px; display: grid; grid-template-columns: 1fr auto auto; gap: 12px; background: linear-gradient(to bottom, rgba(0,0,0,0.8) 0%, transparent 100%); }
        .island { background: var(--island-bg); border: 1px solid rgba(255, 255, 255, 0.1); backdrop-filter: blur(40px); -webkit-backdrop-filter: blur(40px); border-radius: 22px; display: flex; align-items: center; }
        
        .island-date { padding: 12px 18px; flex-direction: column; align-items: flex-start; }
        .date-text { font-size: 11px; font-weight: 800; color: var(--icon-main-color); text-transform: uppercase; transition: 0.4s; text-shadow: 0 0 15px var(--icon-glow); }
        .month-text { font-size: 19px; font-weight: 900; color: #fff; }
        
        .side-controls { display: flex; flex-direction: column; gap: 8px; }
        .theme-btn, .game-btn, .view-btn { border: none; background: rgba(255,255,255,0.05); color: #fff; width: 44px; height: 44px; border-radius: 16px; display: flex; align-items: center; justify-content: center; font-size: 20px; transition: 0.3s; border: 1px solid rgba(255,255,255,0.1); }
        
        .view-btn.active { background: var(--icon-main-color); box-shadow: 0 0 25px var(--icon-glow); border-color: transparent; }

        .island-week { grid-column: 1 / span 3; justify-content: space-between; padding: 10px 15px; margin-top: 5px; }
        .nav-btn { background: rgba(255,255,255,0.1); border: none; color: white; width: 36px; height: 36px; border-radius: 50%; font-weight: 900; }

        .container { padding: 10px 16px 150px; max-width: 600px; margin: 0 auto; }
        
        .day-title { font-size: 26px; font-weight: 900; margin: 30px 0 15px 5px; color: var(--icon-main-color); text-shadow: 0 0 20px var(--icon-glow); transition: 0.4s ease; }
        
        .card { background: rgba(255, 255, 255, var(--glass-opacity)); border-radius: 30px; padding: 22px; margin-bottom: 18px; border: 1px solid rgba(255,255,255,0.1); backdrop-filter: blur(var(--card-blur)); -webkit-backdrop-filter: blur(var(--card-blur)); position: relative; transition: all 0.5s ease; }
        .card.is-passed { opacity: 0.35; filter: grayscale(1); transform: scale(0.98); }
        .card.locked { opacity: 0.15; filter: blur(25px); transform: scale(0.96); }
        .card.revealed { opacity: 1 !important; filter: none !important; transform: scale(1) !important; border-color: var(--icon-main-color); }
        body.hide-locked .card.locked:not(.revealed) { display: none; }
        
        .icon-box { width: 50px; height: 50px; background: var(--icon-main-color); border-radius: 15px; display: flex; align-items: center; justify-content: center; font-size: 24px; box-shadow: 0 0 30px var(--icon-glow); transition: 0.4s ease; }

        .badge { font-size: 10px; font-weight: 900; padding: 6px 12px; border-radius: 12px; text-transform: uppercase; }
        .badge-passed { background: rgba(255,255,255,0.1); color: #888; }
        .badge-live { background: var(--ios-pink); color: white; animation: pulse 1.5s infinite; }
        .badge-timer { border: 1px solid var(--ios-green); color: var(--ios-green); }


        .theme-menu { position: fixed; bottom: -100%; left: 0; width: 100%; background: rgba(10, 10, 12, 0.98); backdrop-filter: blur(50px); border-top: 1px solid rgba(255,255,255,0.15); border-radius: 35px 35px 0 0; padding: 30px 20px 60px; z-index: 2000; transition: bottom 0.5s ease; max-height: 85vh; overflow-y: auto; }
        .theme-menu.open { bottom: 0; }
        .color-row { display: flex; justify-content: space-between; gap: 8px; margin-bottom: 20px; flex-wrap: wrap; }
        .color-dot { width: 42px; height: 42px; border-radius: 12px; border: 2px solid rgba(255,255,255,0.1); }
        .label-theme { font-size: 12px; font-weight: 800; color: var(--text-secondary); margin-bottom: 10px; display: block; text-transform: uppercase; }


        .game-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.95); backdrop-filter: blur(25px); z-index: 3000; display: none; align-items: center; justify-content: center; padding: 20px; }
        .game-card { background: #1c1c1e; border: 1px solid rgba(255, 255, 255, 0.15); border-radius: 35px; padding: 20px; width: 100%; max-width: 400px; position: relative; }
        .pixel-grid { display: grid; grid-template-columns: repeat(12, 1fr); gap: 2px; background: rgba(255,255,255,0.05); padding: 8px; border-radius: 18px; margin-bottom: 20px; }
        .pixel { aspect-ratio: 1; background: #2c2c2e; border-radius: 3px; display: flex; align-items: center; justify-content: center; font-size: 8px; color: #48484a; font-weight: 900; transition: 0.2s; }
        .pal-item { width: 38px; height: 38px; border-radius: 10px; display: flex; align-items: center; justify-content: center; font-weight: 900; font-size: 14px; border: 2px solid transparent; transition: 0.2s; }
        .pal-item.active { border-color: white; transform: scale(1.1); box-shadow: 0 0 10px rgba(255,255,255,0.3); }
        
        .game-progress-container { width: 100%; height: 6px; background: rgba(255,255,255,0.1); border-radius: 10px; margin-bottom: 15px; overflow: hidden; }
        .game-progress-fill { height: 100%; background: var(--ios-pink); width: 0%; transition: 0.3s; }

        .modal-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.8); backdrop-filter: blur(15px); z-index: 4000; display: none; align-items: center; justify-content: center; padding: 30px; }
        .modal-card { background: rgba(30, 30, 32, 0.9); border: 1px solid rgba(255,255,255,0.1); border-radius: 30px; padding: 30px; width: 100%; max-width: 340px; text-align: center; }
        .modal-title { font-weight: 900; font-size: 20px; margin-bottom: 15px; color: #fff; }
        .modal-desc { font-size: 14px; color: var(--text-secondary); line-height: 1.5; margin-bottom: 25px; }
        .modal-btns { display: grid; grid-template-columns: 1fr; gap: 10px; }
        .modal-btn-main { background: var(--ios-pink); border: none; color: #fff; padding: 16px; border-radius: 18px; font-weight: 800; font-size: 14px; }
        .modal-btn-sub { background: rgba(255,255,255,0.05); border: none; color: #fff; padding: 16px; border-radius: 18px; font-weight: 800; font-size: 14px; }

        @keyframes pulse { 0%, 100% { opacity: 1; transform: scale(1); } 50% { opacity: 0.7; transform: scale(1.03); } }
    </style>
</head>
<body class="hide-locked">

<div class="bg-glow" id="bgGlow"></div>

<div class="modal-overlay" id="customModal">
    <div class="modal-card">
        <div class="modal-title">–ü–û–î–¢–í–ï–†–î–ò–¢–ï –î–ï–ô–°–¢–í–ò–ï</div>
        <div class="modal-desc">–í–Ω–∏–º–∞–Ω–∏–µ! –≠—Ç–æ —É–¥–∞–ª–∏—Ç –≤–µ—Å—å –ø—Ä–æ–≥—Ä–µ—Å—Å —Ä–∞—Å–∫—Ä–∞—Å–∫–∏ –∏ –≤–µ—Ä–Ω–µ—Ç –≤–∞—Å –Ω–∞ 1 —É—Ä–æ–≤–µ–Ω—å. –í—ã —É–≤–µ—Ä–µ–Ω—ã?</div>
        <div class="modal-btns">
            <button class="modal-btn-main" onclick="confirmResetAll()">–î–ê, –°–ë–†–û–°–ò–¢–¨</button>
            <button class="modal-btn-sub" onclick="closeModal()">–û–¢–ú–ï–ù–ê</button>
        </div>
    </div>
</div>

<div class="theme-menu" id="themeMenu">
    <div style="text-align:center; font-weight:900; font-size: 20px; margin-bottom:30px;">–†–µ–∂–∏–º –î–∏–∑–∞–π–Ω–µ—Ä–∞</div>
    <span class="label-theme">–í–ï–†–•–ù–ò–ô –õ–ï–í–´–ô –£–ì–û–õ</span>
    <div class="color-row" id="rowGlow1"></div>
    <span class="label-theme">–ù–ò–ñ–ù–ò–ô –ü–†–ê–í–´–ô –£–ì–û–õ</span>
    <div class="color-row" id="rowGlow2"></div>
    <span class="label-theme">–¶–í–ï–¢ –ò–ö–û–ù–û–ö, –ì–õ–ê–ó–ò–ö–û–í –ò –¢–ï–ö–°–¢–ê</span>
    <div class="color-row" id="rowIconGlow"></div>
    <span class="label-theme">–ü–†–û–ó–†–ê–ß–ù–û–°–¢–¨ –ë–õ–û–ö–û–í –†–ê–°–ü–ò–°–ê–ù–ò–Ø</span>
    <input type="range" min="1" max="40" id="glassSlider" style="width:100%; accent-color:var(--ios-pink);" oninput="updateOpacity(this.value)">
    <button onclick="toggleMenu()" style="width:100%; margin-top:30px; background:var(--ios-pink); border:none; color:#fff; padding:18px; border-radius:20px; font-weight:800;">–ü–†–ò–ú–ï–ù–ò–¢–¨</button>
</div>

<div class="game-overlay" id="gameOverlay">
    <div class="game-card">
        <div style="display:flex; justify-content:space-between; margin-bottom:10px; font-weight:900; align-items:center;">
            <span id="artName">ART: HEART</span>
            <span id="artPercent" style="color:var(--ios-pink); font-size:12px;">0%</span>
        </div>
        <div class="game-progress-container"><div class="game-progress-fill" id="gameBar"></div></div>
        <div class="pixel-grid" id="pixelGrid"></div>
        <div id="gamePalette" style="display:flex; gap:8px; justify-content:center; margin-bottom:20px; flex-wrap:wrap;"></div>
        <div id="gameActions" style="display:grid; grid-template-columns: 1fr 1fr; gap:10px; margin-bottom: 10px;">
            <button onclick="resetArt()" style="padding:15px; border-radius:18px; background:#2c2c2e; border:none; color:#fff; font-weight:800; font-size: 12px;">–°–ë–†–û–° –°–õ–û–Ø</button>
            <button onclick="toggleGame()" style="padding:15px; border-radius:18px; background:#3a3a3c; border:none; color:#fff; font-weight:800; font-size: 12px;">–í–´–•–û–î</button>
        </div>
        <button onclick="openResetModal()" style="width:100%; padding:15px; border-radius:18px; background:rgba(255,55,95,0.15); border:1px solid var(--ios-pink); color:var(--ios-pink); font-weight:800; font-size: 12px;">–°–ë–†–û–°–ò–¢–¨ –í–°–Å</button>
        <button id="nextLevelBtn" onclick="nextTemplate()" style="display:none; width:100%; padding:18px; border-radius:18px; background:var(--ios-green); border:none; color:#fff; font-weight:900; margin-top:10px; animation: pulse 1s infinite;">–°–õ–ï–î–£–Æ–©–ò–ô –£–†–û–í–ï–ù–¨ ‚ú®</button>
    </div>
</div>

<div class="header-islands">
    <div class="island island-date">
        <span class="date-text" id="islandDay">---</span>
        <span class="month-text" id="islandDate">---</span>
    </div>
    <div class="side-controls">
        <button class="theme-btn" onclick="toggleMenu()">üé®</button>
        <button class="game-btn" onclick="toggleGame()">üéÆ</button>
    </div>
    <div class="island island-controls" style="padding:6px; gap:6px;">
        <button class="view-btn" id="btnShowAll" onclick="setViewMode('all')">üëÅÔ∏è</button>
        <button class="view-btn active" id="btnHideLocked" onclick="setViewMode('clean')">üôà</button>
    </div>
    <div class="island island-week">
        <button class="nav-btn" onclick="changeWeek(-1)">-</button>
        <div style="text-align: center;">
            <span style="font-size:9px; color:var(--text-secondary); text-transform:uppercase; font-weight:700;" id="weekType">–¢–ï–ö–£–©–ê–Ø –ù–ï–î–ï–õ–Ø</span>
            <span class="week-num" id="weekNumDisplay" style="display:block; font-size:22px; font-weight:900;">1</span>
        </div>
        <button class="nav-btn" onclick="changeWeek(1)">+</button>
    </div>
</div>

<div class="container" id="scheduleRoot"></div>

<script>
    const START_DATE = new Date('2026-02-09T00:00:00');
    const schedule = [
        { d: 1, t: "10:10 - 11:40", s: "–¢–∞—Ç–∞—Ä—Å–∫–∏–π –Ø–∑—ã–∫", r: "258, 262, 263", p: "–°–∏–±–≥–∞–µ–≤–∞ / –ù–∞–±–∏—É–ª–ª–∏–Ω–∞", w: [1,15], i: "üïå" },
        { d: 1, t: "10:10 - 11:40", s: "–û—Å–Ω. –∫–æ–º–ø–æ–∑–∏—Ü–∏–∏ –∏ –¥–∏–∑–∞–π–Ω–∞", r: "262", p: "–ö—Ä–∏–Ω—Å–∫–∞—è –ó.–ê.", w: [16,17], i: "üìê" },
        { d: 2, t: "08:00 - 09:30", s: "–§–∏–∑–∏—á–µ—Å–∫–∞—è –ö—É–ª—å—Ç—É—Ä–∞", r: "–°–ö –ú–æ—Å–∫–≤–∞", p: "–®–∞–ª–∞–≤–∏–Ω–∞ –ê.–°.", w: [1,16], i: "üëü" },
        { d: 2, t: "10:10 - 11:40", s: "–ö–æ–º–ø. –∏ –¥–∏–∑–∞–π–Ω –≤ —Ä–µ–∫–ª–∞–º–µ", r: "207", p: "–ö—Ä–∏–Ω—Å–∫–∞—è –ó.–ê.", w: [1,7], i: "üé®" },
        { d: 2, t: "10:10 - 11:40", s: "–ì—Ä–∞—Ñ–∏—á–µ—Å–∫–æ–µ –∏—Å–∫—É—Å—Å—Ç–≤–æ", r: "171", p: "–®–∞–π—Ö—É—Ç–¥–∏–Ω–æ–≤–∞ –ê.–†.", w: [8,14], i: "‚úíÔ∏è" },
        { d: 3, t: "08:30 - 10:00", s: "–ò—Å—Ç–æ—Ä–∏—è –†–æ—Å—Å–∏–∏", r: "355 –∞–∫—Ç.–∑–∞–ª", p: "–°–∞–º–∞—Ç–æ–≤–∞ –ß.–•.", w: [1,8], i: "üìú" },
        { d: 3, t: "08:30 - 10:00", s: "–ü—Ä–æ—Ñ. –ø—Ä–∞–∫—Ç–∏–∫–∞", r: "444", p: "–ê–Ω–∏—Ñ–µ—Ä–æ–≤–∞ –í.–í.", w: [9,17], i: "üíº" },
        { d: 3, t: "10:10 - 11:40", s: "–ò—Å—Ç–æ—Ä–∏—è –†–æ—Å—Å–∏–∏", r: "355 –∞–∫—Ç.–∑–∞–ª", p: "–°–∞–º–∞—Ç–æ–≤–∞ –ß.–•.", w: [1,9], i: "üá∑üá∫" },
        { d: 3, t: "10:10 - 11:40", s: "–ü—Ä–æ—Ñ. –ø—Ä–∞–∫—Ç–∏–∫–∞", r: "429", p: "–ê–Ω–∏—Ñ–µ—Ä–æ–≤–∞ –í.–í.", w: [10,17], i: "üìÇ" },
        { d: 3, t: "12:10 - 13:40", s: "–Ø–∑—ã–∫ –∏ —Å—Ç–∏–ª—å –°–ú–ò", r: "473", p: "–ê–Ω–∏—Ñ–µ—Ä–æ–≤–∞ –í.–í.", w: [8,14], i: "‚úçÔ∏è" },
        { d: 3, t: "13:50 - 15:20", s: "–¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏ —Ä–µ–∫–ª–∞–º–Ω–æ–≥–æ –ø—Ä-–≤–∞", r: "239", p: "–®–∞–π—Ö—É—Ç–¥–∏–Ω–æ–≤ –¢.–ú.", w: [1,2], i: "üé¨" },
        { d: 3, t: "13:50 - 15:20", s: "–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏", r: "473", p: "–ê–ª–µ—Ö–∞–Ω–¥—Ä–æ", w: [11,17], i: "üíª" },
        { d: 3, t: "17:30 - 19:00", s: "–¢–µ—Ö–Ω–æ–ª–æ–≥–∏—è –ø—Ä–æ–∏–∑–≤.", r: "346", p: "–®–∞–π—Ö—É—Ç–¥–∏–Ω–æ–≤ –¢.–ú.", w: [9,14], i: "üé•" },
        { d: 3, t: "19:10 - 20:40", s: "–í–∏–¥–µ–æ–∫–æ–Ω—Ç–µ–Ω—Ç (–ü—Ä–∞–∫—Ç–∏–∫—É–º)", r: "210 / 475", p: "–Ø–º—â–∏–∫–æ–≤ –ò.–í.", w: [9,16], i: "üéûÔ∏è" },
        { d: 4, t: "08:30 - 10:00", s: "–ö–æ–º–ø—å—é—Ç–µ—Ä–Ω–∞—è –≥—Ä–∞—Ñ–∏–∫–∞", r: "475", p: "–®–∞–º—Å—É—Ç–¥–∏–Ω–æ–≤ –†.–ù.", w: [1,17], i: "üñ•Ô∏è" },
        { d: 4, t: "10:10 - 11:40", s: "PR –∏ –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏–∏", r: "239", p: "–°–∞—Ñ–∏–Ω–∞ –õ.–ù.", w: [1,17], i: "üì¢" },
        { d: 4, t: "12:10 - 13:40", s: "–ö–æ–º–ø—å—é—Ç–µ—Ä–Ω–∞—è –≥—Ä–∞—Ñ–∏–∫–∞", r: "473", p: "–®–∞–º—Å—É—Ç–¥–∏–Ω–æ–≤ –†.–ù.", w: [11,14], i: "üñ±Ô∏è" },
        { d: 4, t: "13:50 - 15:20", s: "–≠—Å—Ç–µ—Ç–∏–∫–∞ –º–µ–¥–∏–∞", r: "346/210", p: "–ê—Ö–º–µ—Ç—à–∏–Ω–∞ –≠.–ì.", w: [3,17], i: "üé≠" },
        { d: 4, t: "15:50 - 17:20", s: "–Ø–∑—ã–∫ –∏ —Å—Ç–∏–ª—å –°–ú–ò", r: "207", p: "–ê–Ω–∏—Ñ–µ—Ä–æ–≤–∞ –í.–í.", w: [1,5], i: "üñãÔ∏è" },
        { d: 4, t: "17:30 - 19:00", s: "–≠—Å—Ç–µ—Ç–∏–∫–∞ –ú–µ–¥–∏–∞ –ö–æ–º–º.", r: "210", p: "–ê—Ö–º–µ—Ç—à–∏–Ω–∞ –≠.–ì.", w: [3,7], i: "üí°" },
        { d: 4, t: "17:30 - 19:00", s: "–Ø–∑—ã–∫ –°–ú–ò", r: "207", p: "–ê–Ω–∏—Ñ–µ—Ä–æ–≤–∞ –í.–í.", w: [10,15], i: "üì∞" },
        { d: 4, t: "19:10 - 20:40", s: "–ü—Ä–æ—Ñ. –ø—Ä–∞–∫—Ç–∏–∫–∞", r: "256", p: "–ê–Ω–∏—Ñ–µ—Ä–æ–≤–∞ –í.–í.", w: [1,9], i: "üíº" },
        { d: 5, t: "08:00 - 09:30", s: "–§–∏–∑–∏—á–µ—Å–∫–∞—è –ö—É–ª—å—Ç—É—Ä–∞", r: "–°–ö –ú–æ—Å–∫–≤–∞", p: "–®–∞–ª–∞–≤–∏–Ω–∞ –ê.–°.", w: [1,16], i: "üëü" },
        { d: 5, t: "10:10 - 11:40", s: "–ë—Ä–µ–Ω–¥-–∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏–∏", r: "444", p: "–ú–∏—à–∞–ª–∏–Ω–∞ –ú.–ê.", w: [1,17], i: "üíé" },
        { d: 5, t: "12:10 - 13:40", s: "–¢–∏–ø–æ–≥—Ä–∞—Ñ–∏–∫–∞ –∏ —à—Ä–∏—Ñ—Ç", r: "464 (—Å 11–Ω: 476)", p: "–°–∞—Ñ–∏–Ω–∞ –≠.–°.", w: [1,17], i: "üé®" },
        { d: 5, t: "17:30 - 19:10", s: "–ò—Å—Ç–æ—Ä–∏—è –†–æ—Å—Å–∏–∏", r: "263", p: "–ö–∏—Å–∏–ª–µ–Ω–∫–æ –ê.–û.", w: [1,12], i: "üèõÔ∏è" },
        { d: 6, t: "08:30 - 10:00", s: "–¶–û–† –¢–∏–ø–æ–≥—Ä–∞—Ñ–∏–∫–∞", r: "464", p: "–°–∞—Ñ–∏–Ω–∞ –≠.–°.", w: [1,5], i: "üíª" },
        { d: 6, t: "08:30 - 10:00", s: "–ê–Ω–≥–ª–∏–π—Å–∫–∏–π –Ø–∑—ã–∫", r: "465", p: "–ë—É—Ä–ª–∞–∫–æ–≤–∞ –≠.–í.", w: [17,17], i: "üá¨üáß" },
        { d: 6, t: "12:10 - 13:40", s: "–ò–Ω–æ—Å—Ç—Ä–∞–Ω–Ω—ã–π –Ø–∑—ã–∫", r: "464/475/476", p: "–ë—É—Ä–ª–∞–∫–æ–≤–∞ / –ü–ª–∞–Ω–∫–∏–Ω–∞", w: [1,17], i: "üåç" },
        { d: 6, t: "13:50 - 15:20", s: "–ñ–∏–≤–æ–ø–∏—Å—å", r: "171", p: "–°–∞—Ñ–∏–Ω–∞", w: [3,9], i: "üñºÔ∏è" },
        { d: 6, t: "13:50 - 15:20", s: "–§–∏–ª–æ–ª. –ë—Ä–µ–Ω–¥–∏–Ω–≥", r: "239", p: "–ë–ª–∞–≥–æ–¥–∞—Ä–æ–≤–∞ –û.–ê.", w: [10,14], i: "üìö" },
        { d: 6, t: "15:50 - 17:20", s: "–§–∏–ª–æ–ª–æ–≥–∏—è –ë—Ä–µ–Ω–¥–∏–Ω–≥–∞", r: "239", p: "–ë–ª–∞–≥–æ–¥–∞—Ä–æ–≤–∞ –û.–ê.", w: [10,13], i: "üìñ" },
        { d: 6, t: "17:30 - 19:00", s: "–§–∏–ª–æ–ª–æ–≥–∏—è –ë—Ä–µ–Ω–¥–∏–Ω–≥–∞", r: "239", p: "–ë–ª–∞–≥–æ–¥–∞—Ä–æ–≤–∞ –æ.–∞.", w: [1,9], i: "‚úíÔ∏è" },
        { d: 6, t: "17:30 - 19:00", s: "–ò–Ω—Ñ–æ—Ç–µ—Ö", r: "473", p: "–ê–ª–µ—Ö–∞–Ω–¥—Ä–æ", w: [10,17], i: "üì±" },
        { d: 6, t: "19:10 - 20:40", s: "–ò–Ω—Ñ–æ—Ç–µ—Ö (–¶–û–†)", r: "–û–Ω–ª–∞–π–Ω", p: "–ê–ª–µ—Ö–∞–Ω–¥—Ä–æ", w: [1,3], i: "‚òÅÔ∏è" }
    ];

    const gameTemplates = [
        { n: "HEART", c: ["#ff375f","#ff80ab"], d: [0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,1,1,0,0,0,0,1,1,1,1,0,1,1,1,1,0,0,0,1,1,1,1,1,1,1,1,1,0,0,0,1,1,1,1,1,1,1,1,1,0,0,0,0,1,1,1,1,1,1,1,0,0,0,0,0,0,1,1,1,1,1,0,0,0,0,0,0,0,0,1,1,1,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0] },
        { n: "CREEPER", c: ["#30d158","#000"], d: [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,2,1,1,1,1,1,1,2,2,1,1,2,2,1,1,1,1,1,1,2,2,1,1,1,1,1,2,2,2,2,1,1,1,1,1,1,1,2,2,2,2,2,2,1,1,1,1,1,1,2,2,2,2,2,2,1,1,1,1,1,1,2,2,1,1,2,2,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1] },
        { n: "SMILE", c: ["#ffcc00","#000"], d: [0,0,1,1,1,1,1,1,0,0,0,0,0,1,1,1,1,1,1,1,1,0,0,0,0,1,1,2,1,1,1,1,2,1,1,0,0,1,1,1,1,1,1,1,1,1,1,0,0,1,2,1,1,1,1,1,1,2,1,0,0,1,1,2,2,2,2,2,2,1,1,0,0,1,1,1,1,1,1,1,1,1,1,0,0,0,1,1,1,1,1,1,1,1,0,0,0,0,0,1,1,1,1,1,1,0,0,0] }
    ];

    let currentArtIdx = 0;
    let selectedColorIdx = null; 
    let artProgress = JSON.parse(localStorage.getItem('sumbul_art')) || {};

    function openResetModal() { document.getElementById('customModal').style.display = 'flex'; }
    function closeModal() { document.getElementById('customModal').style.display = 'none'; }
    function confirmResetAll() { artProgress = {}; localStorage.removeItem('sumbul_art'); currentArtIdx = 0; initGame(); closeModal(); }

    function initGame() {
        const art = gameTemplates[currentArtIdx];
        document.getElementById('artName').innerText = `ART: ${art.n}`;
        const grid = document.getElementById('pixelGrid'); grid.innerHTML = '';
        let totalColored = 0, totalTarget = art.d.filter(v => v !== 0).length;
        
        art.d.forEach((val, i) => {
            const pixel = document.createElement('div'); pixel.className = 'pixel';
            const pKey = `${currentArtIdx}_${i}`;
            if (val === 0) { pixel.style.background = 'transparent'; pixel.style.border = 'none'; }
            else {
                if (artProgress[pKey]) { pixel.style.background = art.c[val-1]; totalColored++; }
                else { 
                    pixel.innerText = val; 
                    pixel.onclick = () => { 
                        
                        if (selectedColorIdx !== null && selectedColorIdx + 1 === val) {
                            artProgress[pKey] = true; 
                            localStorage.setItem('sumbul_art', JSON.stringify(artProgress)); 
                            initGame(); 
                        }
                    }; 
                }
            }
            grid.appendChild(pixel);
        });
        const percent = Math.floor((totalColored / totalTarget) * 100);
        document.getElementById('artPercent').innerText = `${percent}%`;
        document.getElementById('gameBar').style.width = `${percent}%`;
        document.getElementById('nextLevelBtn').style.display = (percent === 100) ? 'block' : 'none';
        document.getElementById('gameActions').style.display = (percent === 100) ? 'none' : 'grid';
        
        const pal = document.getElementById('gamePalette'); pal.innerHTML = '';
        art.c.forEach((color, idx) => {
            const item = document.createElement('div'); 
            item.className = `pal-item ${selectedColorIdx === idx ? 'active' : ''}`;
            item.style.background = color; item.innerText = idx + 1;
            item.style.color = (color === '#ffffff' || color === '#ffcc00') ? '#000' : '#fff';
            item.onclick = () => { selectedColorIdx = idx; initGame(); }; 
            pal.appendChild(item);
        });
    }

    function nextTemplate() { currentArtIdx = (currentArtIdx + 1) % gameTemplates.length; selectedColorIdx = null; initGame(); }
    function resetArt() { if(confirm("–°–±—Ä–æ—Å–∏—Ç—å —Å–ª–æ–π?")) { Object.keys(artProgress).forEach(k => { if(k.startsWith(currentArtIdx + '_')) delete artProgress[k]; }); localStorage.setItem('sumbul_art', JSON.stringify(artProgress)); initGame(); } }

    function saveTheme() {
        const theme = {
            g1: document.documentElement.style.getPropertyValue('--glow-1'),
            g2: document.documentElement.style.getPropertyValue('--glow-2'),
            im: document.documentElement.style.getPropertyValue('--icon-main-color'),
            ig: document.documentElement.style.getPropertyValue('--icon-glow'),
            op: document.documentElement.style.getPropertyValue('--glass-opacity')
        };
        localStorage.setItem('sumbul_theme_v4', JSON.stringify(theme));
    }

    function loadTheme() {
        const theme = JSON.parse(localStorage.getItem('sumbul_theme_v4'));
        if(theme) {
            document.documentElement.style.setProperty('--glow-1', theme.g1);
            document.documentElement.style.setProperty('--glow-2', theme.g2);
            document.documentElement.style.setProperty('--icon-main-color', theme.im);
            document.documentElement.style.setProperty('--icon-glow', theme.ig);
            document.documentElement.style.setProperty('--glass-opacity', theme.op);
            document.getElementById('glassSlider').value = theme.op * 100;
        }
    }

    const customColors = [
        { c: '#ff375f' }, { c: '#007aff' }, { c: '#30d158' },
        { c: '#ffcc00' }, { c: '#af52de' }, { c: '#ffffff' },
        { c: '#000000' }, { c: '#8e8e93' }
    ];

    function initThemes() {
        const r1 = document.getElementById('rowGlow1'), r2 = document.getElementById('rowGlow2'), ri = document.getElementById('rowIconGlow');
        customColors.forEach(color => {
            r1.innerHTML += `<div class="color-dot" style="background:${color.c}" onclick="setGlow('glow1', '${color.c}')"></div>`;
            r2.innerHTML += `<div class="color-dot" style="background:${color.c}" onclick="setGlow('glow2', '${color.c}')"></div>`;
            ri.innerHTML += `<div class="color-dot" style="background:${color.c}" onclick="setGlow('icon', '${color.c}')"></div>`;
        });
    }

    function setGlow(type, color) {
        if(type === 'glow1') document.documentElement.style.setProperty('--glow-1', color + '73');
        else if(type === 'glow2') document.documentElement.style.setProperty('--glow-2', color + '59');
        else if(type === 'icon') {
            document.documentElement.style.setProperty('--icon-main-color', color);
            const glowHex = (color === '#000000') ? '#ffffff33' : color + '99'; 
            document.documentElement.style.setProperty('--icon-glow', glowHex);
        }
        saveTheme();
    }

    function updateOpacity(v) { document.documentElement.style.setProperty('--glass-opacity', v/100); saveTheme(); }

    let realWeek = Math.floor((new Date() - START_DATE) / 604800000) + 1;
    let currentWeek = Math.max(1, Math.min(22, realWeek));

    function setViewMode(mode) {
        document.body.classList.toggle('hide-locked', mode === 'clean');
        document.getElementById('btnHideLocked').classList.toggle('active', mode === 'clean');
        document.getElementById('btnShowAll').classList.toggle('active', mode === 'all');
    }

    function changeWeek(v) { currentWeek = Math.max(1, Math.min(22, currentWeek+v)); render(); }
    function toggleMenu() { document.getElementById('themeMenu').classList.toggle('open'); }
    function toggleGame() { 
        const el = document.getElementById('gameOverlay'); el.style.display = el.style.display==='flex'?'none':'flex';
        if(el.style.display === 'flex') initGame();
    }

    function getSmartStatus(l, selWeek) {
        const now = new Date(); const curDay = now.getDay() === 0 ? 7 : now.getDay();
        const [sh, sm] = l.t.split(' - ')[0].split(':').map(Number);
        const [eh, em] = l.t.split(' - ')[1].split(':').map(Number);
        if (selWeek < l.w[0] || selWeek > l.w[1]) return { label: `–ù–µ–¥. ${l.w[0]}-${l.w[1]}`, class: "badge-locked", type: 'locked' };
        if (selWeek > realWeek) return { label: "–ë—É–¥–µ—Ç", class: "badge-timer", type: 'future' };
        if (selWeek < realWeek) return { label: "–ü—Ä–æ—à–ª–∞", class: "badge-passed", type: 'passed' };
        const st = new Date(now); st.setHours(sh, sm, 0); const et = new Date(now); et.setHours(eh, em, 0);
        if (curDay > l.d || (curDay === l.d && now > et)) return { label: "–ü—Ä–æ—à–ª–∞", class: "badge-passed", type: 'passed' };
        if (curDay === l.d && now >= st && now <= et) return { label: "–°–ï–ô–ß–ê–° –ò–î–ï–¢", class: "badge-live", type: 'live' };
        if (curDay === l.d && now < st) {
            const diff = st - now; const h = Math.floor(diff/3600000); const m = Math.floor((diff%3600000)/60000);
            return { label: `–ß–µ—Ä–µ–∑ ${h}—á ${m}–º`, class: "badge-timer", type: 'timer' };
        }
        return { label: `–ß–µ—Ä–µ–∑ ${l.d - curDay} –¥–Ω.`, class: "badge-timer", type: 'upcoming' };
    }

    function render() {
        const root = document.getElementById('scheduleRoot');
        document.getElementById('weekNumDisplay').innerText = currentWeek;
        const now = new Date();
        document.getElementById('islandDay').innerText = now.toLocaleDateString('ru-RU', { weekday: 'long' });
        document.getElementById('islandDate').innerText = now.toLocaleDateString('ru-RU', { day: 'numeric', month: 'long' });
        root.innerHTML = "";
        ["–ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫", "–í—Ç–æ—Ä–Ω–∏–∫", "–°—Ä–µ–¥–∞", "–ß–µ—Ç–≤–µ—Ä–≥", "–ü—è—Ç–Ω–∏—Ü–∞", "–°—É–±–±–æ—Ç–∞"].forEach((name, idx) => {
            const items = schedule.filter(l => l.d === idx + 1);
            if(!items.length) return;
            const section = document.createElement('div');
            section.innerHTML = `<div class="day-title">${name}</div>`;
            items.forEach((l) => {
                const status = getSmartStatus(l, currentWeek);
                const isLocked = status.type === 'locked';
                section.innerHTML += `<div class="card ${isLocked?'locked':''} ${status.type==='passed'?'is-passed':''} ${status.type==='live'?'is-live':''}">
                    ${isLocked?`<div style="position:absolute;right:15px;top:15px;width:35px;height:35px;background:rgba(255,255,255,0.1);border-radius:50%;display:flex;align-items:center;justify-content:center;z-index:10;" onclick="this.parentElement.classList.toggle('revealed')">üëÅÔ∏è</div>`:''}
                    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:15px;"><span style="font-size:20px;font-weight:800;">${l.t}</span><span class="badge ${status.class}">${status.label}</span></div>
                    <div style="display:flex;gap:15px;align-items:center;">
                        <div class="icon-box">${l.i}</div>
                        <div><h3 style="margin:0;font-size:16px;">${l.s}</h3><p style="margin:4px 0 0;font-size:12px;color:var(--text-secondary);">${l.r} ‚Ä¢ ${l.p}</p></div>
                    </div>
                </div>`;
            });
            root.appendChild(section);
        });
    }

    initThemes(); loadTheme(); render(); setInterval(render, 30000);
</script>
</body>
</html>
